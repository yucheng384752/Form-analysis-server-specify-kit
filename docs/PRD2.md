# Form Analysis Server

## Introduction
å·¥å» ä½¿ç”¨é€™å€‹ç³»çµ±ç®¡ç†è¼¸å…¥çš„csvæª”æ¡ˆï¼Œä¸¦é€²è¡Œè³‡æ–™çš„å³æ™‚æœå°‹

## Objectives 
### ä¸Šå‚³é é¢
é‡å°æ¯å€‹å‹•ä½œéƒ½é¡¯ç¤ºtoastæç¤º
- å€å¡Šä¸€
  1. å¯ä»¥ä½¿ç”¨æ‹–æ›³ä¸Šå‚³èˆ‡é¸æ“‡æª”æ¡ˆä¸Šå‚³ -> æ”¯æ´å¤šæª”æ¡ˆä¸Šå‚³
  2. åƒ…æ”¯æ´csvä¸Šå‚³ï¼Œæª”æ¡ˆå¤§å°é™åˆ¶10MB
  3. å…·æœ‰hoveræç¤ºåŠŸèƒ½ï¼Œåœ¨ä¸Šå‚³å€åŸŸé»æ“Š**é–‹å•Ÿæª”æ¡ˆé¸æ“‡**
- å€å¡ŠäºŒ
  1. å¯ä»¥çœ‹åˆ°ä¸Šå‚³é€²åº¦
  2. é¡¯ç¤º**ç¢ºèªé©—è­‰**æŒ‰éˆ•
  3. åœ¨é©—è­‰æ™‚é¡¯ç¤ºé€²åº¦æ¢(å€å¡Š3.1)
  4. åœ¨ä¸Šå‚³å®Œæˆæ™‚ï¼ŒæŒ‰ä¸‹**ç¢ºèª**é€²è¡Œå¿…è¦è¡¨æ ¼é©—è­‰
  5. åœ¨é©—è­‰æ™‚ï¼Œè¦é–å®šé©—è­‰æŒ‰éˆ•
  6. åœ¨é¡¯ç¤ºæª”æ¡ˆçš„å€å¡Šè¦æœ‰**å–æ¶ˆ(X)**æŒ‰éˆ•å¯ä»¥åˆªé™¤ä¸Šå‚³æª”æ¡ˆ
- å€å¡Šä¸‰
  1. é¡¯ç¤ºcsvå…§å®¹ç·¨è¼¯(å›ºå®šæ¨™é¡Œæ¬„ã€å³å´æ»‘æ¡¿ã€ä¸‹æ–¹æ»‘æ¡¿)
  2. å„²å­˜æ ¼æœƒ**æ ¹æ“šæœ€é•·çš„æ¬„ä½**å‹•æ…‹åŒæ­¥æ‰€æœ‰è¡¨æ ¼çš„å¯¬åº¦
  3. æä¾› **å„²å­˜ä¿®æ”¹**ã€**ç¢ºèªåŒ¯å…¥** æŒ‰éˆ•
  4. æ ¹æ“šä¸Šå‚³çš„è³‡æ–™æä¾›æç¤ºè¨Šæ¯: å…± X è¡Œè³‡æ–™ï¼ŒY å€‹æ¬„ä½ï¼›æç¤ºï¼šé»æ“Šä»»æ„å„²å­˜æ ¼å³å¯ç›´æ¥ç·¨è¼¯å…§å®¹
  5. åœ¨å„²å­˜ä¿®æ”¹å‰ï¼Œç„¡æ³•æŒ‰ä¸‹ç¢ºèªåŒ¯å…¥æŒ‰éˆ•
  6. æŒ‰ä¸‹**ç¢ºèªåŒ¯å…¥**æŒ‰éˆ•æ™‚ï¼Œé¡¯ç¤ºå½ˆçª—:  æ˜¯å¦ç¢ºèªä¸Šå‚³ï¼›æ­¤æ“ä½œå°‡æœƒæŠŠ CSV æª”æ¡ˆåŒ¯å…¥è³‡æ–™åº«ä¸­ï¼Œè«‹ç¢ºèªæ˜¯å¦è¦ç¹¼çºŒï¼Ÿ
  7. åŒ¯å…¥è³‡æ–™åº«æ™‚é¡¯ç¤ºé€²åº¦æ¢
  8. å¯ä»¥å…ˆæœå°‹è³‡æ–™åº«æ˜¯å¦æœ‰ç›¸åŒlot_noä»¥åŠPhaseçš„è³‡æ–™ï¼Œæœ‰çš„è©±è¦æç¤ºUser
  9. åŒ¯å…¥å®Œç•¢å¾Œï¼Œæ›´æ–°é é¢ï¼Œå›åˆ°æœ€åˆçš„ç•«é¢

### æŸ¥è©¢é é¢
- å€å¡Šä¸€
  1. è¼¸å…¥lot_no(æ”¯æ´æ¨¡ç³Šæœå°‹)
  2. æ ¹æ“šæœå°‹åˆ°çš„çµæœï¼Œé¡¯ç¤ºP1ã€P2ã€P3åˆ†é (ä¸è«–æ˜¯å¦æœ‰è³‡æ–™)
- å€å¡ŠäºŒ
  1. æ ¹æ“š**è‡ªå®šç¾©**çš„è¡¨æ ¼é¡¯ç¤ºè¦å‰‡åˆ†æˆæ•¸å€‹å€å¡Š(æ ¹æ“šå®¢æˆ¶éœ€è¦)(å€å¡Š2.1, 2.2, 2.3 ...)




## Warning & To-do
- [X] ä¿®æ”¹æœå°‹é‚è¼¯: å¯ä»¥å¥—ç”¨"ç¬¦åˆç‰¹å®šè¼¸å…¥"çš„æ¨¡å¼
- [X] ä¿®æ”¹"ç”Ÿç”¢æ—¥æœŸ"å»ºç«‹é‚è¼¯ï¼Œp2, p3æœ‰å°æ‡‰æ¬„ä½(æ°‘åœ‹å¹´->è¥¿å…ƒå¹´)ï¼Œp1(YYYY-MM-DD)
- [X] åŠ å…¥æ”¯æ´PDFæª”æ¡ˆä¸Šå‚³ <- éœ€è¦ç¢ºèªinput&output çš„æ ¼å¼
- [X] æ¬„ä½èª¿æ•´
- [X] åŠ å…¥ product_id æ¬„ä½åœ¨è³‡æ–™åº«
   - [X] éœ€è¦ç¢ºèªæ˜¯å¦æœ‰å°æ‡‰å¤šå¼µp1, p2è¡¨
   - [X] éœ€è¦é »ç¹æŸ¥è©¢çš„æ¬„ä½å®šç¾©å€‹åˆ¥æ¬„ä½ï¼Œå…¶é¤˜ä½¿ç”¨JSONBæ ¼å¼å„²å­˜
- [X] è³‡æ–™åº«å…§å®¹éœ€è¦å¯ä»¥è¼¸å‡ºæˆ Dataframe æ ¼å¼(å¾ŒçºŒ)
- [X] éœ€è¦ç¢ºèªp2, p3çš„é—œè¯æ€§(2507173_02_17 -> 17 ç‚ºå°æ‡‰çš„P2 lot_no ä¸­çš„ winder number)
- [X] p1, p3 specificationæ˜¯å¦æœ‰é—œ
- [X] "Qaulity inspecrion"ã€"Qaulity control"æ˜¯å¦éœ€è¦å¾è¡¨?
- [X] ä¸‹æ‹‰é¸å–®å…§éœ€è¦æœ‰"æ—¥æœŸ(æŒ‡å®šè¥¿å…ƒå¹´)""P3è¦æ ¼""æ©Ÿå°è™Ÿç¢¼""ä¸‹è† ç·¨è™Ÿ" => éœ€è¦éƒ½å¥—ç”¨æ¨¡ç³Šæœå°‹
- [X] P3_No. æ¬„ä½å·²ä¸å†ä½¿ç”¨ï¼Œç§»é™¤å¿…è¦é©—è­‰ï¼ˆä¿ç•™åœ¨ additional_data ä¸­ä»¥å…¼å®¹èˆŠè³‡æ–™ï¼‰
- [X] ç§»é™¤"è³‡æ–™æŸ¥è©¢é é¢" - "é«˜ç´šæŸ¥è©¢" - ç”¢å“åç¨±æœå°‹åˆ— -> æ”¹æˆ"ç”¢å“ç·¨è™ŸæŸ¥è©¢"
- [X] "é«˜ç´šæŸ¥è©¢" ç”Ÿç”¢æ—¥æœŸèµ·è¨–æ—¥éœ€è¦åšå°é½Š
- [X] "é«˜ç´šæŸ¥å°‹" åŠ å…¥ "ä½¿ç”¨P3çš„è¦æ ¼é€²è¡Œæœå°‹"çš„åŠŸèƒ½
- [X] adjustment record æ˜¯å¦æœ‰å°æ‡‰ A, B, C çš„é¸é …?
- [X] 10Po å‰ç«¯booleanè½‰æ›(V/X)
- [X] P2 "åˆ†æ¢æ™‚é–“" é¡¯ç¤ºæ™‚éœ€è¦ "æ°‘åœ‹å¹´è½‰è¥¿å…ƒå¹´"
- [X] P3 shiftã€ironã€moldã€rubber wheelã€finish æ¬„ä½éœ€å‰ç«¯booleanè½‰æ›
- [X] P2 appearanceã€rough edgeã€striped results æ¬„ä½éœ€è¦å‰ç«¯booleanè½‰æ›
- [X] slitting machine æ²’æœ‰å°æ‡‰åˆ°å¾è¡¨(è½‰æ›è¡¨)ï¼Œéœ€è¦ä¿®æ­£
- [ ] P1 çš„ product date éœ€è¦ä½¿ç”¨"æ—¥æœŸ"æ ¼å¼ï¼Œä¸¦ä¸”è½‰æ›æˆè¥¿å…ƒå¹´(YYYY-MM-DD)
- [ ] P3 éœ€é¡¯ç¤ºçµ„åˆå¾Œçš„ product_idï¼Œä¸¦ä¸”è¦å¯ä»¥ç”¨åœ¨æœå°‹(æ›¿ä»£å‰ç«¯"åŸºæœ¬è³‡æ–™"p3_noæ¬„ä½)
- [X] ç”Ÿç”¢æ—¥æœŸæ¬„ä½çµ±ä¸€ï¼šP1â†’"Production Date"ã€P2â†’"åˆ†æ¢æ™‚é–“"ã€P3â†’"year-month-day"
  - æ‰€æœ‰æ—¥æœŸçµ±ä¸€è½‰æ›ç‚º YYYY-MM-DD æ ¼å¼
  - æ°‘åœ‹å¹´è‡ªå‹•è½‰è¥¿å…ƒå¹´
  - å„²å­˜åˆ° production_date æ¬„ä½
  - å·²æ•´åˆåˆ°åŒ¯å…¥æµç¨‹ (routes_import.py)
- [ ] updated_at é‚è¼¯ä¸è®Šï¼Œcreated_at è¦å¥—ç”¨ä¸‹åˆ—é‚è¼¯:
  - P1: Production Date â†’ data_date (å»ºè­°æ–°å¢æ¬„ä½)
  - P2: Semi-finished productsLOT NO â†’ data_date
  - P3: year-month-day â†’ data_date
- [X] é«˜ç´šæœå°‹å…§ï¼Œæ¨¡å…·ç·¨è™Ÿæ”¹æˆä½¿ç”¨ä¸‹è† ç·¨è™Ÿ(Bottom Tape)æœå°‹å°æ‡‰è³‡æ–™

## å¯¦ä½œæ–¹æ¡ˆ

### ç”Ÿç”¢æ—¥æœŸæå–é‚è¼¯ å·²å®Œæˆ
å·²å»ºç«‹ production_date_extractor.py æœå‹™ä¸¦æ•´åˆåˆ° routes_import.pyï¼š
- P1: å¾ "Production Date" æå–ï¼Œæ”¯æ´ YYYY-MM-DDã€YYMMDDã€YY-MM-DD
- P2: å¾ "åˆ†æ¢æ™‚é–“" æå–ï¼Œæ”¯æ´æ°‘åœ‹å¹´æ ¼å¼ YYY/MM/DDã€YYY-MM-DDã€YYYMMDD
- P3: å¾ "year-month-day" æå–ï¼Œæ”¯æ´ "114å¹´09æœˆ02æ—¥"ã€YYY/MM/DD
- æ‰€æœ‰æ ¼å¼çµ±ä¸€è½‰æ›ç‚º date ç‰©ä»¶å„²å­˜åˆ° production_date æ¬„ä½

### ğŸ”„ éƒ¨ç½²æ­¥é©Ÿ

#### 1. é‡å»º Docker æ˜ åƒï¼ˆå¦‚ä½¿ç”¨ Dockerï¼‰
```bash
cd form-analysis-server
docker-compose down
docker-compose build
docker-compose up -d
```

#### 2. æˆ–ç›´æ¥é‡å•Ÿå¾Œç«¯æœå‹™ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
```bash
cd form-analysis-server/backend
# åœæ­¢ç¾æœ‰æœå‹™
# é‡æ–°å•Ÿå‹•
python -m uvicorn app.main:app --reload --port 18002
```

#### 3. æ¸¬è©¦æ–°åŠŸèƒ½
ä¸Šå‚³ä¸€å€‹ P2 æˆ– P3 æª”æ¡ˆï¼Œç¢ºèªï¼š
- production_date æ¬„ä½æ­£ç¢ºå¡«å…¥
- æ°‘åœ‹å¹´æ­£ç¢ºè½‰æ›ç‚ºè¥¿å…ƒå¹´
- P1 çš„æ—¥æœŸæ­£ç¢ºè§£æ

### ä½¿ç”¨ç¯„ä¾‹
```python
# P1 ç¯„ä¾‹
production_date = production_date_extractor.extract_production_date(
    row_data={'additional_data': {'Production Date': '2024-01-15'}},
    data_type='P1'
)  # çµæœ: date(2024, 1, 15)

# P2 ç¯„ä¾‹ï¼ˆæ°‘åœ‹å¹´ï¼‰
production_date = production_date_extractor.extract_production_date(
    row_data={'additional_data': {'åˆ†æ¢æ™‚é–“': '114/09/02'}},
    data_type='P2'
)  # çµæœ: date(2025, 9, 2)

# P3 ç¯„ä¾‹ï¼ˆä¸­æ–‡æ ¼å¼ï¼‰
production_date = production_date_extractor.extract_production_date(
    row_data={'additional_data': {'year-month-day': '114å¹´09æœˆ02æ—¥'}},
    data_type='P3'
)  # çµæœ: date(2025, 9, 2)
```

## æŠ€è¡“åˆ†æå‚™è¨»
### #1 P1/P2 Material é—œè¯
-  å…©è€…éƒ½ä½¿ç”¨ material_code æ¬„ä½
-  æœ‰æ•ˆææ–™ï¼šH2, H5, H8
-  å¯é€é lot_no + material_code è¿½æº¯é—œè¯

### #2 Quality Inspection/Control
-  P2 æ¬„ä½ï¼Œå“æª¢å“ç®¡äººå“¡è¼¸å…¥
-  å„²å­˜åœ¨ additional_data JSONB
-  ç„¡éœ€å»ºç«‹å¾è¡¨

### #3 Slitting Machine è½‰æ›
-  å¾Œç«¯å°æ‡‰è¡¨: {1: "åˆ†1Points 1", 2: "åˆ†2Points 2"}
-  å‰ç«¯å·²å¯¦ä½œ formatFieldValue è½‰æ›

### #5 Product_ID çµ„åˆé‚è¼¯
- æ ¼å¼: YYYY-MM-DD_æ©Ÿå°_æ¨¡è™Ÿ_LOT
- ç¯„ä¾‹: 2025-09-02_P24_238-2_301
-  å¾Œç«¯ç”¢ç”Ÿå™¨å·²å¯¦ä½œ
-  é«˜ç´šæœå°‹å·²æ”¯æ´
- â“ å‰ç«¯é¡¯ç¤ºä½ç½®éœ€ç¢ºèª

### é«˜ç´šæœå°‹ç­–ç•¥
- å»ºè­°ï¼šé™¤æ‰¹è™Ÿå¤–ï¼Œå…¶ä»–æœå°‹ä»¥P3ç‚ºä¸»
- å¯¦ä½œï¼šP3 â†’ lot_no/winder â†’ P2 â†’ P1 è¿½æº¯éˆ