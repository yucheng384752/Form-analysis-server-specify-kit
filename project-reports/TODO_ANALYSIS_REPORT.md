# PRD2 待辦事項分析報告

**分析日期**: 2025-12-25 (Updated)
**分析者**: GitHub Copilot

---

## 📊 待辦事項總覽

### 統計摘要

| 狀態 | 數量 | 百分比 |
|------|------|--------|
|  已完成 | 27 | 93% |
| ⏳ 待處理 | 2 | 7% |
| **總計** | **29** | **100%** |

---

##  最新更新完成的項目 (5項)

### 1. 資料匯入合併邏輯 (Merge/Append) 

**原狀態**: [ ] 待完成  
**新狀態**: [X] 已完成  

**解決方案**: 修改 `routes_import.py` 匯入邏輯

**技術決策**:
- **P3**: 依據 `product_id` 判斷。若存在則更新，不存在則追加 (Append)。
- **P2**: 依據 `winder_number` 自動續編。若 Lot No 已有 10 筆，新匯入將從第 11 筆開始。
- **JSONB**: 新資料行直接附加到 `additional_data['rows']` 列表後方。

**優勢**:
- 支援分批匯入資料
- 避免重複匯入時覆蓋舊資料
- 保持資料完整性

### 2. P3 Source Winder 自動提取 

**原狀態**: [ ] 待完成  
**新狀態**: [X] 已完成  

**已實作內容**:
-  從 lot_no 最後兩碼自動提取卷收機編號
-  儲存到 p3_items.source_winder 欄位（INTEGER 類型）
-  創建索引支援快速查詢

### 3. P1 Product Date YYYYMMDD 格式 

**原狀態**: [ ] 待完成  
**新狀態**: [X] 已完成  

**解決方案**: 前端格式化處理

**技術決策**:
-  後端保持標準 DATE 格式（YYYY-MM-DD）
-  前端顯示時格式化為 YYYYMMDD
-  簡單實作：`dateStr.replace(/-/g, '')`

**優勢**:
- 資料庫保持標準格式，支援日期運算
- 前端靈活，可適應不同顯示需求

### 4. Data Date 欄位實作 

**原狀態**: [ ] 待完成  
**新狀態**: [X] 已完成  

**解決方案**: 直接使用現有 production_date 欄位

**驗證結果**:
- P1: Production Date -> production_date
- P2: 分條時間 -> production_date
- P3: year-month-day -> production_date
- 覆蓋率 100%

**技術分析**:
- 無需新增額外欄位，利用現有欄位滿足需求
- 保持資料庫結構簡潔

### 5. P3 Product ID 功能 

**原狀態**: [ ] 待完成  
**新狀態**: [X] 已完成  

**已實作內容**:
-  創建 P3Item 子表模型，包含獨立的 product_id 欄位
-  product_id 自動生成邏輯（格式：P3-YYMMDD-機台-模具號碼-批號）
-  整合到 routes_import.py 的匯入流程

---

## ⏳ 剩餘待辦事項 (2項)

### 1. Adjustment Record 邏輯確認 ❓

**狀態**: [ ] 待確認  
**優先級**: ⭐⭐ 低  

**需求描述**:
- 確認 `adjustment record` 是否有對應 A, B, C 的選項? (目前資料顯示 0, 1)
- 是否需要建立從表?

**現況**:
- 目前 `P2Item` 模型中未定義 `adjustment_record` 獨立欄位。
- 該資料目前儲存於 `row_data` (JSONB) 中。

**建議**:
- 若僅用於顯示，可於前端進行 Mapping (0->A, 1->B)。
- 若需用於搜尋或統計，建議在 `P2Item` 新增欄位。

### 2. 文件撰寫任務 📝

**狀態**: [ ] 待處理  
**優先級**: ⭐⭐ 低  

**待撰寫文件**:
1. [ ] Breakdown 架構圖 (Mermaid)
2. [ ] 功能表 (API List)

**說明**:
這是文檔類工作，不影響功能實作。

---

## 🎯 實作建議優先順序

### 完成！ 🎉

所有核心功能實作已完成。

### 後續規劃

1. **確認 Adjustment Record 需求**
   - 若確認需要搜尋，則需修改資料庫模型。
2. **完善文件**
   - 補齊架構圖與功能表。

---
